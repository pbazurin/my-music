$(function(){$.UI.Explorer.Init(),$.UI.Player.Init()}),$.UI=$.UI||{},$.UI.Explorer={_musicItems:[],_historyPrefix:"?v=",_itemClass:"explorer_content_item",_activeItemClass:"explorer_content_item--active",_activeSearchClass:"explorer_toolbar_search_text--active",_$template:null,_$currentPath:null,ItemType:{Folder:0,MusicItem:1},Init:function(e){var t=$.UI.Explorer;t._$template=$("#explorerItemTemplate"),t._$currentPath=$(".explorer_toolbar_currPath"),$(window).on("popstate",t.CheckHistory),$(document).on("click","."+t._itemClass,function(){var e=$(this),r=e.data("item");r.type===t.ItemType.MusicItem&&(history.pushState(null,"",t._historyPrefix+r.yId),$.UI.Player.Play(r),t.UpdateSelection())}).on("dblclick","."+t._itemClass,function(){var e=$(this).data("item");e.type===t.ItemType.Folder&&t.GoToFolder(e.path)}),$(".explorer_toolbar_search_text").on("focus",function(){$(this).addClass(t._activeSearchClass)}).on("blur",function(){var e,r=$(this);r.val()||(r.removeClass(t._activeSearchClass),e=$.UI.Player.GetCurrentItem(),t.GoToItem(e))}).on("keyup",function(){t.Search($(this).val())}),$.getJSON("musicdb.min.txt",function(r){$.each(r,function(e,r){r.name=r.path.split("/").pop(),r.type=t.ItemType.MusicItem}),r.sort(function(e,t){return e.path.toUpperCase()>t.path.toUpperCase()?1:-1}),t._musicItems=r,t.CheckHistory(),$.isFunction(e)&&e()})},GoToFolder:function(e){var t,r,a=[],n=[],o=$.UI.Explorer,l=$(".explorer_content");e&&a.push({name:"...",type:o.ItemType.Folder,path:e.split("/").slice(0,-1).join("/")}),$.each(o._musicItems,function(r,l){if(!e||-1!==l.path.indexOf(e)){var i=e?l.path.replace(e+"/",""):l.path;if(-1===i.indexOf("/"))return void n.push(l);t=i.split("/")[0],0===$.grep(a,function(e){return e.name==t}).length&&a.push({name:t,type:o.ItemType.Folder,path:e?e+"/"+t:t})}}),r=a.concat(n),l.empty(),o._$template.tmpl(r).appendTo(l),o._$currentPath.html(e),o.UpdateSelection()},GoToItem:function(e){var t=$.UI.Explorer,r=$.UI.Player,a=e?e.path.split("/").slice(0,-1).join("/"):"",n=r.GetCurrentItem();t.GoToFolder(a),e&&(t.UpdateSelection(),n&&n.yId===e.yId||r.Play(e))},GetSelectedItem:function(){var e,t,r=$.UI.Explorer,a=document.URL.indexOf(r._historyPrefix);return-1===a?null:(e=document.URL.slice(a+r._historyPrefix.length),$.each(r._musicItems,function(r,a){return a.yId===e?void(t=a):void 0}),t)},UpdateSelection:function(){var e=$.UI.Explorer,t=e.GetSelectedItem();$("."+e._activeItemClass).removeClass(e._activeItemClass),t&&$.each($("."+e._itemClass),function(r,a){var n=$(a);return n.data("item").path===t.path?void n.addClass(e._activeItemClass):void 0})},Search:function(e){var t=[],r=$.UI.Explorer,a=$(".explorer_content");$.each(r._musicItems,function(r,a){e&&-1===a.name.toUpperCase().indexOf(e.toUpperCase())||t.push(a)}),t.sort(function(e,t){return e.name.toUpperCase()>t.name.toUpperCase()?1:-1}),a.empty(),r._$template.tmpl(t).appendTo(a),r._$currentPath.empty(),r.UpdateSelection()},CheckHistory:function(){var e=$.UI.Explorer,t=e.GetSelectedItem();t?e.GoToItem(t):e.GoToFolder()}},$.UI=$.UI||{},$.UI.Player={_player:null,_currentItem:null,_initialItem:null,_$title:null,Init:function(e){var t=$.UI.Player;t._$title=$(".player_header"),$("<script>").attr({type:"text/javascript",src:"https://www.youtube.com/player_api"}).appendTo("head"),window.onYouTubePlayerAPIReady=function(){t._player=new YT.Player("ytplayer",{videoId:"guXMb7zLblM",playerVars:{rel:0,showinfo:0},events:{onReady:t.OnPlayerReady,onStateChange:t.OnPlayerStateChange,onError:t.OnPlayerError}})},$.isFunction(e)&&e()},Play:function(e){var t=$.UI.Player;return t._player&&t._player.loadVideoById?(t._player.loadVideoById(e.yId),t._$title.html(e.name),void(t._currentItem=e)):void(t._initialItem=e)},GetCurrentItem:function(){return $.UI.Player._currentItem},OnPlayerReady:function(){var e=$.UI.Player;e._initialItem&&e.Play(e._initialItem),$.UI.Player._player.playVideo()},OnPlayerStateChange:function(e){0===e.data&&$.UI.Player._player.playVideo()},OnPlayerError:function(){ga&&ga("send","exception",{exDescription:"Player doesn't feel well"})}};