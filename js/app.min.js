$(function(){$.UI.Explorer.Init(),$.UI.Player.Init()}),$.UI=$.UI||{},$.UI.Explorer={_musicItems:[],_historyPrefix:"?v=",_itemClass:"explorer_content_item",_activeItemClass:"explorer_content_item--active",_activeSearchClass:"explorer_toolbar_search_text--active",_$template:null,_$currentPath:null,ItemType:{Folder:0,MusicItem:1},Init:function(t){var a=$.UI.Explorer;a._$template=$("#explorerItemTemplate"),a._$currentPath=$(".explorer_toolbar_currPath"),$(window).on("popstate",a.CheckHistory),$(document).on("click","."+a._itemClass,function(){var e=$(this).data("item");e.type===a.ItemType.MusicItem?(history.pushState(null,"",a._historyPrefix+e.yId),$.UI.Player.Play(e),a.UpdateSelection()):a.GoToFolder(e.path)}),$(".explorer_toolbar_search_text").on("focus",function(){$(this).addClass(a._activeSearchClass)}).on("blur",function(){var e,t=$(this);t.val()||(t.removeClass(a._activeSearchClass),e=$.UI.Player.GetCurrentItem(),a.GoToItem(e))}).on("keyup",function(){a.Search($(this).val())}),$.getJSON("db/music-db.min.txt",function(e){$.each(e,function(e,t){t.name=t.path.split("/").pop(),t.type=a.ItemType.MusicItem}),e.sort(function(e,t){return e.path.toUpperCase()>t.path.toUpperCase()?1:-1}),a._musicItems=e,a.CheckHistory(),$.isFunction(t)&&t()})},GoToFolder:function(r){var n,e,o=[],l=[],i=$.UI.Explorer,t=$(".explorer_content");r&&o.push({name:"...",type:i.ItemType.Folder,path:r.split("/").slice(0,-1).join("/")}),$.each(i._musicItems,function(e,t){var a;r&&-1===t.path.indexOf(r)||(-1!==(a=r?t.path.replace(r+"/",""):t.path).indexOf("/")?(n=a.split("/")[0],0===$.grep(o,function(e){return e.name==n}).length&&o.push({name:n,type:i.ItemType.Folder,path:r?r+"/"+n:n})):l.push(t))}),e=o.concat(l),t.empty(),i._$template.tmpl(e).appendTo(t),i._$currentPath.html(r),i.UpdateSelection()},GoToItem:function(e){var t=$.UI.Explorer,a=$.UI.Player,r=e?e.path.split("/").slice(0,-1).join("/"):"",n=a.GetCurrentItem();t.GoToFolder(r),e&&(t.UpdateSelection(),n&&n.yId===e.yId||a.Play(e))},GetSelectedItem:function(){var a,r,e=$.UI.Explorer,t=document.URL.indexOf(e._historyPrefix);return-1===t?null:(a=document.URL.slice(t+e._historyPrefix.length),$.each(e._musicItems,function(e,t){t.yId!==a||(r=t)}),r)},UpdateSelection:function(){var r=$.UI.Explorer,n=r.GetSelectedItem();$("."+r._activeItemClass).removeClass(r._activeItemClass),n&&$.each($("."+r._itemClass),function(e,t){var a=$(t);a.data("item").path!==n.path||a.addClass(r._activeItemClass)})},Search:function(a){var r=[],e=$.UI.Explorer,t=$(".explorer_content");$.each(e._musicItems,function(e,t){a&&-1===t.name.toUpperCase().indexOf(a.toUpperCase())||r.push(t)}),r.sort(function(e,t){return e.name.toUpperCase()>t.name.toUpperCase()?1:-1}),t.empty(),e._$template.tmpl(r).appendTo(t),e._$currentPath.empty(),e.UpdateSelection()},CheckHistory:function(){var e=$.UI.Explorer,t=e.GetSelectedItem();t?e.GoToItem(t):e.GoToFolder()}},$.UI=$.UI||{},$.UI.Player={_player:null,_currentItem:null,_initialItem:null,_$title:null,Init:function(e){var t=$.UI.Player;t._$title=$(".player_header"),$("<script>").attr({type:"text/javascript",src:"https://www.youtube.com/player_api"}).appendTo("head"),window.onYouTubePlayerAPIReady=function(){t._player=new YT.Player("ytplayer",{videoId:"guXMb7zLblM",playerVars:{rel:0,showinfo:0},events:{onReady:t.OnPlayerReady,onStateChange:t.OnPlayerStateChange,onError:t.OnPlayerError}})},$.isFunction(e)&&e()},Play:function(e){var t=$.UI.Player;t._player&&t._player.loadVideoById?(t._player.loadVideoById(e.yId),t._$title.html(e.name),t._currentItem=e):t._initialItem=e},GetCurrentItem:function(){return $.UI.Player._currentItem},OnPlayerReady:function(){var e=$.UI.Player;e._initialItem&&e.Play(e._initialItem),$.UI.Player._player.playVideo()},OnPlayerStateChange:function(e){0===e.data&&$.UI.Player._player.playVideo()},OnPlayerError:function(){ga&&ga("send","exception",{exDescription:"Player doesn't feel well"})}};